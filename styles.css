:root {
  --bg: #f5f7fb;
  --panel: #ffffff;
  --muted: #475569;
  --text: #0b1326;
  --brand: #004379;   /* UCAM Blue */
  --brand-2: #EDAB00; /* UCAM Gold */
  --ring: rgba(0, 67, 121, 0.35);
  --ok: #0a7e3b;
  --warn: #EDAB00;
  --danger: #c0392b;
  --shadow: 0 4px 12px rgba(0,0,0,.08);
}
@media (prefers-color-scheme: dark) {
  :root {
    --bg: #0b1020;
    --panel: #0f172a;
    --muted: #94a3b8;
    --text: #e2e8f0;
    --ring: rgba(0, 67, 121, .35);
  }
}
*{box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
  background:var(--bg); color:var(--text);
}
a{color:var(--brand); text-decoration:none}
a:hover{text-decoration:underline}
.container{max-width:1100px; margin-inline:auto; padding:24px}

header{position:sticky; top:0; z-index:50; background-color:var(--brand); border-bottom:4px solid var(--brand-2)}
.nav{display:flex; align-items:center; gap:16px; padding:14px 22px; color:#fff}
.brand{font-weight:700; letter-spacing:.2px; font-size:1.1rem}
.spacer{flex:1}

.pills{display:flex; gap:10px}
.pill{display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; background:var(--panel); border:1px solid var(--brand); color:var(--brand); font-weight:600; font-size:.9rem}
.pill:hover{background:var(--brand); color:#fff}

h1{font-size:clamp(28px, 4vw, 42px); line-height:1.1; margin:14px 0}
.subtitle{color:var(--muted); font-size:clamp(15px, 2vw, 18px)}

section{scroll-margin-top:92px}
.grid{display:grid; grid-template-columns:repeat(12, 1fr); gap:18px}
.card{grid-column:span 12; background:var(--panel); border:1px solid rgba(0,0,0,.1); border-radius:8px; padding:18px; box-shadow:var(--shadow)}
.card h2{margin:2px 0 8px; font-size:clamp(20px, 3vw, 28px)}
.card p{color:var(--muted)}
.card .badges{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
.badge{padding:6px 10px; border-radius:999px; font-weight:600; font-size:.8rem; border:1px dashed rgba(0,0,0,.2); background:rgba(0,0,0,.04)}
.list{margin:12px 0 0 0; padding:0 0 0 18px}
.list li{margin:6px 0}

@media (min-width: 860px){
  .card.span-6{grid-column:span 6}
  .card.span-4{grid-column:span 4}
  .card.span-8{grid-column:span 8}
}

.steps{counter-reset: step}
.step{display:flex; gap:12px; align-items:flex-start; padding:12px 0}
.step::before{counter-increment: step; content: counter(step); font-weight:800; width:32px; height:32px; display:grid; place-items:center; background:var(--brand); color:#fff; border-radius:4px}

details{background:rgba(0,0,0,.04); border:1px solid rgba(0,0,0,.1); border-radius:6px; padding:12px 14px}
details+details{margin-top:10px}
summary{cursor:pointer; font-weight:700}

.kicker{display:inline-flex; align-items:center; gap:8px; font-weight:700; letter-spacing:.3px; text-transform:uppercase; font-size:.78rem; color:var(--brand)}
.kbd{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; font-weight:700; padding:2px 6px; border-radius:4px; background:rgba(0,0,0,.04); border:1px solid rgba(0,0,0,.1)}

.cta{display:inline-flex; align-items:center; gap:10px; padding:12px 16px; border-radius:6px; font-weight:800; letter-spacing:.25px; border:1px solid var(--brand); background-color:var(--brand); color:#fff}
.cta:hover{background-color:var(--brand-2); border-color:var(--brand-2)}

.footer{padding:24px; color:var(--muted); text-align:center; border-top:1px solid rgba(0,0,0,.1)}

/* ====== MAPPA ====== */
#map { height: 420px; width: 100%; }
.leaflet-container { overflow: hidden; border-radius: 8px; border:1px solid rgba(0,0,0,.1); }

/* Toolbar filtri mappa */
.map-toolbar {
  display:flex; gap:12px; flex-wrap:wrap; margin:8px 0 12px;
}
.map-toolbar label {
  display:inline-flex; align-items:center; gap:6px;
  background:#fff; border:1px solid rgba(0,0,0,.12);
  padding:6px 10px; border-radius:18px;
}

/* Legenda mappa */
.legend {
  background:#fff; padding:8px 10px; border:1px solid rgba(0,0,0,.15);
  border-radius:6px; font-size:.9rem; box-shadow:0 2px 8px rgba(0,0,0,.08);
}
.legend-row { display:flex; align-items:center; gap:8px; margin:4px 0; }
.swatch { display:inline-block; width:14px; height:14px; border-radius:3px; }
.swatch-blue  { background:#004379; opacity:.7; }
.swatch-gold  { background:#EDAB00; opacity:.8; }
.swatch-green { background:#2E7D32; opacity:.8; }

/* Fallback minimo se il CSS del CDN tarda: mantiene i tiles in posizione */
.leaflet-pane, .leaflet-tile, .leaflet-marker-icon, .leaflet-tile-container,
.leaflet-pane > canvas, .leaflet-pane > svg { position: absolute; left: 0; top: 0; }